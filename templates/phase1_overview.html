<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PrimaHealth Phase 1 Workflow</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 40px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
    }
    #mermaidChart {
      padding: 20px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }
    .mermaid {
      font-size: 16px;
    }
    svg {
      max-width: 100% !important;
      height: auto !important;
    }
  </style>
</head>
<body>
  <h1>Phase 1: Patient Intake and Screening Workflow</h1>
  <div id="mermaidChart">
    <pre class="mermaid">
      {% raw %}
      flowchart TD
          Start(["Start: New Enquiry<br>(Phone, Email, GP Referral, Webform, WhatsApp)"]) --> Source{"What is the source?"}
      
          Source -- Phone Call --> M1["Send: New Enquiry â€“ Phone Call Received<br><sub>ğŸ“ WA</sub>"]
          Source -- Voicemail --> M2["Send: Missed Call â€“ Voicemail<br><sub>ğŸ“ WA</sub>"]
          Source -- No Voicemail --> M3["Send: Missed Call â€“ No Voicemail<br><sub>ğŸ“ WA</sub>"]
          Source -- Webform --> M4["Send: Webform â€“ Callback Request<br><sub>ğŸ“ WA</sub>"]
          Source -- Email --> M5["Send: Email â€“ Info Request (Attach Parent Info)<br><sub>ğŸ“ WA and Email</sub>"]
          Source -- GP Referral --> M6["Send: GP Referral Received â€“ No Screening Call<br><sub>ğŸ“ WA and Email</sub>"]
      
          M1 --> ExistingCheck{"Is it an existing record?"}
          M2 --> ExistingCheck
          M3 --> ExistingCheck
          M4 --> ExistingCheck
          M5 --> ExistingCheck
          M6 --> ExistingCheck
      
          ExistingCheck -- Yes --> LoadRec["Load Patient Record"]
          LoadRec --> GPCheck
          ExistingCheck -- No --> CreateRec["Create Patient Record"]
          CreateRec --> M0
      
          M0["Send: PrimaHealth Reference Number<br><sub>ğŸ“ WA</sub>"] --> GPCheck{"Is GP Referral Received?"}
      
          GPCheck -- Yes --> M19["Send: GP Referral Received â€“ Havenâ€™t Booked Screening Call<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M19 --> SCBookedNow{"Is Screening Call Already Booked?"}
          GPCheck -- No --> SCBookedNow
      
          SCBookedNow -- Yes --> M9["Send: Screening Call â€“ Booking Confirmation<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          SCBookedNow -- No --> WaitMore["WaitMore"]
      
          WaitMore -- 7 Days No Response --> M7["Send: No Contact â€“ 7 Day Follow-up<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M7 --> CallAttempt["ğŸ“ Flag CC to make a Phone Call Attempt after 7 days"]
          CallAttempt --> CallAnswered{"Was the call answered?"}
      
          CallAnswered -- Yes, Wants to proceed --> BookNowCheck{"Did they book Screening Call immediately?"}
          BookNowCheck -- Yes --> M9
          BookNowCheck -- No --> FollowUp14Days
      
          CallAnswered -- Yes, Does NOT want to proceed --> SendCloseFamily["Send: Family Not Proceeding<br><sub>ğŸ“ WA if consented, else Email</sub>"] --> CloseFamily["Sad End: Close â€“ Family Not Proceeding"]
          CallAnswered -- Yes, Will book later --> RemindWA["Wait for 7 more days"]
          RemindWA --> FollowUp14Days
          CallAnswered -- No --> NoAnswerFollowup["Wait for 7 more days"]
          NoAnswerFollowup --> FollowUp14Days
      
          FollowUp14Days["Send: No Contact â€“ 14 Day Follow-up<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          FollowUp14Days -- 7 More Days No Response --> SendCloseNoContact["Send: No Contact from Family<br><sub>ğŸ“ WA if consented, else Email</sub>"] --> Close1["Sad End: Auto-Close â€“ No Booking"]
          FollowUp14Days -- SC Booked --> M9
      
          M9 --> ChildCheck{"Two Children's Names Provided?"}
          ChildCheck -- Yes --> M20["Send: Screening Call â€“ Two Childrenâ€™s Names Confirmed<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M20 --> APAssign["Assign to AP Calendar Queue"]
          ChildCheck -- No --> APAssign
      
          APAssign --> APExec["AP Executes Screening Call (Phone)"]
          APExec --> CheckSchoolFields{"Are School Name, Email, or Teacher Name missing in CRM?"}
          CheckSchoolFields -- Yes --> MFollowSchool["Send: School Details â€“ Follow-up Request<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          MFollowSchool --> GPCheck2{"Is GP Referral Received?"}
          CheckSchoolFields -- No --> GPCheck2
      
          GPCheck2 -- No --> M21a["Send: SC Completed â€“ GP Referral Pending<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M21a --> FlagCheck{"Red Flags Identified?"}
          GPCheck2 -- Yes --> InfoCheck{"Any missing documents?"}
      
          FlagCheck -- Yes --> RedList["Red Flag Types:<br>â€¢ CAMHS<br>â€¢ Eating Disorder<br>â€¢ Non-Verbal Child<br>â€¢ Suicide Attempts<br>â€¢ Can't Attend In-Person<br>â€¢ Over 18<br>â€¢ AP Clinical Concern"]
          RedList --> NotSuitableReason{"Reason for Not Proceeding?"}
          NotSuitableReason -- CAMHS --> SendCloseCAMHS["Send: CAMHS Engagement<br><sub>ğŸ“ WA if consented, else Email</sub>"] --> CloseRedFlag["Sad End: Red Flag â€“ Do Not Proceed"]
          NotSuitableReason -- Over 18 --> SendCloseOver18["Send: Services Not Suitable â€“ Over 18<br><sub>ğŸ“ WA if consented, else Email</sub>"] --> CloseRedFlag
          NotSuitableReason -- Other Red Flags --> SendCloseServiceNotSuitable["Send: Red Flag other than CAMHS<br><sub>ğŸ“ WA if consented, else Email</sub>"] --> CloseRedFlag
          FlagCheck -- No --> InfoCheck
      
          InfoCheck -- Yes --> M22a["Send: SC Completed â€“ Awaiting Previous Reports<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M22a --> DocWait["Wait for Docs"]
          DocWait -- 14 Days --> DocReceived{"Docs Received?"}
          DocReceived -- No --> EscalateMissing["Flag to CC: Missing Docs (Manual Escalation)"]
          EscalateMissing --> SendCloseIncomplete["Send: Closure â€“ Incomplete Case (Missing Documents)<br><sub>ğŸ“ WA if consented, else Email</sub>"] --> Close2["Sad End: Close â€“ Incomplete Case â€“ Missing Documents"]
          DocReceived -- Yes --> G2Check{"Is G2 Consent Required?"}
      
          InfoCheck -- No --> G2Check
          G2Check -- Yes --> M12["Send: Consent â€“ G2 Required<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M12 --> Wait7DaysG2["â³ Wait 7 Days Before Follow-up"]
          Wait7DaysG2 --> M13["Send: Consent â€“ G2 Follow-up<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M13 --> M14["Send: Consent â€“ G2 Received<br><sub>ğŸ“ WA if consented, else Email</sub>"]
      
          G2Check -- No --> CMReview["Care Manager Review"]
          M14 --> CMReview
      
          CMReview --> Decision{"Care Manager Decision"}
          Decision -- Accepted --> M17["Send: GP Referral Confirmed â€“ SC Done<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M17 --> FinalPrep["Assessment Ready"]
          FinalPrep --> M18["Send: Assessment â€“ Next Steps Notification<br><sub>ğŸ“ WA if consented, else Email</sub>"]
          M18 --> HappyEnd["Happy End: Proceed to Assessment"]
      
          Decision -- Rejected --> SendCloseRejected["Send: Services Not Suitable â€“ e.g. looking for other services/support<br><sub>ğŸ“ WA if consented, else Email</sub>"] --> Close3["Sad End: Rejected"]
          Decision -- On Hold --> HoldStatus["Status: Awaiting Additional Info"]
      
          %% Styling
          class M0,M1,M2,M3,M4,M5,M6,M7,M9,M12,M13,M14,M17,M18,M19,M20,M21a,M22a,MFollowSchool,RemindWA,NoAnswerFollowup,CallAttempt,FollowUp14Days,SendCloseNoContact,SendCloseIncomplete,SendCloseFamily,SendCloseRejected,SendCloseCAMHS,SendCloseOver18,SendCloseServiceNotSuitable message
          class Close1,Close2,Close3,CloseRedFlag,CloseFamily sadend
          class CRMUpdateYes,CRMUpdateNo,Wait24H,ConsentResponse,Wait7DaysG2 logic
          classDef message fill:#fef6e4,stroke:#c4a000,stroke-width:1px
          classDef sadend fill:#ffe6e6,stroke:#cc0000,stroke-width:1px
          classDef logic fill:#e0f7fa,stroke:#00796b,stroke-width:1px
      {% endraw %}
      </pre>
      
  </div>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      flowchart: {
        useMaxWidth: true,
        htmlLabels: true,
        padding: 10,
        curve: 'basis'
      }
    });
  </script>
</body>
</html>
